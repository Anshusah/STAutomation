// JavaScript Document
console.log(tinymce);
tinymce.PluginManager.add('Cicerofilemanager', function(editor, url) {
	editor.addButton('Cicerofilemanager', {
		title: 'File Manager',
		text: '',
		icon: true,
		icon: 'image',
		onclick: function() {
			// Open window with a specific url
			var win=editor.windowManager.open({
						title: 'File Manager',
						file: encodeURI(tinyMCE.activeEditor.getParam('upload_path')),
						width : 720 + parseInt(editor.getLang('openmanager.delta_width', 0)),
						height : 400 + parseInt(editor.getLang('openmanager.delta_height', 0)),
						buttons: [{
								text: 'Insert File',
								classes: 'widget btn primary first abs-layout-item',
								disabled: false,
								onclick: function(e){
									var form = jQuery('[src="'+encodeURI(tinyMCE.activeEditor.getParam('upload_path'))+'"]').contents();
									
									var file_url=form.find("a.active").data('json');
									if(typeof(file_url)!='undefined'){
										tinymce.activeEditor.execCommand('mceInsertContent', false,'<img src="/uploads/'+file_url.url+'" />');
									}
									win.close();
									
								}
							}, {
								text: 'Cancle',
								onclick: 'close'
							}]
						
						},
						{
						Editor:editor
						}
						);
		}
	});
});
